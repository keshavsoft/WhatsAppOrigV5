<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./assets/compiled/svg/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON Visualizer - JSONVis</title>
    
    <style>
        :root {
            --dark-1: rgb(20, 20, 22);
            --dark-2: #1e1e1e;
            --dark-3: #2d2d2d;
            --accent-blue: rgb(133, 133, 255);
            --accent-cyan: #4fc3f7;
            --accent-green: #20c997;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', Courier, monospace;
        }

        body {
            background-color: var(--dark-1);
            height: 100vh;
            overflow: hidden;
            color: var(--text-primary);
        }
        
        #app {
            height: 100%;
            display: flex;
        }
        
        #editor {
            display: flex;
            flex-direction: row;
            height: 100%;
            width: 100%;
        }
        
        /* Sidebar Styles */
        .editor-sidebar {
            width: min(380px, 30%);
            background-color: var(--dark-2);
            height: 100%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .back-link {
            color: var(--accent-cyan);
            text-decoration: none;
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            background-color: var(--dark-3);
        }
        
        .back-link:hover {
            background-color: rgba(79, 195, 247, 0.1);
            padding-left: 1.5rem;
        }
        
        .editor-header {
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--dark-2) 0%, var(--dark-3) 100%);
        }
        
        .editor-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .editor-header button {
            background: linear-gradient(135deg, #28a745, var(--accent-green));
            border: none;
            color: white;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            text-transform: uppercase;
        }
        
        .editor-header button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .editor-header button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        /* Textarea Styles */
        .textarea-editor {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .textarea-editor textarea {
            width: 100%;
            height: 100%;
            font-size: 0.8rem;
            line-height: 1.4;
            background-color: var(--dark-2);
            color: var(--text-primary);
            border: none;
            padding: 1rem;
            resize: none;
            outline: none;
            font-family: 'Fira Code', 'Courier New', monospace;
            tab-size: 2;
        }
        
        .textarea-editor textarea::selection {
            background-color: rgba(133, 133, 255, 0.3);
        }
        
        .textarea-editor textarea::-webkit-scrollbar {
            width: 12px;
        }
        
        .textarea-editor textarea::-webkit-scrollbar-track {
            background: var(--dark-1);
        }
        
        .textarea-editor textarea::-webkit-scrollbar-thumb {
            background: var(--dark-3);
            border-radius: 6px;
            border: 2px solid var(--dark-1);
        }
        
        .textarea-editor textarea::-webkit-scrollbar-thumb:hover {
            background: #404040;
        }
        
        /* Visualization Styles */
        .visualization {
            flex-grow: 1;
            overflow: hidden;
            background-color: var(--dark-1);
            position: relative;
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: row;
            gap: 10px;
            z-index: 100;
            align-items: center;
        }
        
        .zoom-btn {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: rgba(45, 45, 50, 0.95);
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .zoom-btn:hover {
            background: rgba(60, 60, 70, 0.95);
            border-color: var(--accent-cyan);
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }
        
        .zoom-btn:active {
            transform: scale(0.95);
        }
        
        .zoom-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        
        .zoom-level {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(45, 45, 50, 0.95);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 0.85rem;
            text-align: center;
            color: var(--text-primary);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 70px;
            font-weight: 600;
            z-index: 100;
        }
        
        #visualizer {
            width: 100%;
            height: 100%;
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            touch-action: none;
        }
        
        #visualizer:active {
            cursor: grabbing;
        }
        
        /* Card Styles */
        #visualizer .card-content {
            color: var(--text-primary);
        }
        
        .object-text-wrapper {
            padding: 0;
            list-style: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            font-size: 0.85rem;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }
        
        .object-text-wrapper div {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        
        .object-text-wrapper div:last-child {
            margin-bottom: 0;
        }
        
        .object-text-wrapper .object-key {
            color: var(--accent-blue);
            font-weight: 500;
        }
        
        .object-text-wrapper .object-value {
            color: var(--text-primary);
            font-weight: 400;
        }
        
        .object-text-wrapper .string {
            color: #ce9178;
        }
        
        .card-extension {
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.8rem;
        }
        
        /* Card rectangles with improved styling */
        #cards rect {
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: filter 0.2s ease;
        }
        
        #cards g:hover rect {
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5));
        }
        
        /* Line styles */
        #lines path {
            transition: stroke-opacity 0.2s ease;
        }
        
        #lines path:hover {
            stroke-opacity: 0.6 !important;
        }
        
        /* Utility Classes */
        .btn-toggle-view {
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .btn-transparent {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-transparent:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-cyan);
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .editor-sidebar {
                width: min(350px, 40%);
            }
            
            .editor-header h3 {
                font-size: 1.25rem;
            }
            
            .textarea-editor textarea {
                font-size: 0.85rem;
                padding: 1rem;
            }
        }
        
        @media (max-width: 768px) {
            .editor-sidebar {
                width: 100%;
                max-width: none;
            }
            
            .visualization {
                display: none;
            }
        }
        
        /* Animation for initial load */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #cards g {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Grid pattern enhancement */
        #background {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="editor">
            <div class="editor-sidebar">
                <a href="sendMessage.html" class="back-link">← Back to Send Message</a>
                <div class="editor-header">
                    <h3>JSONVis</h3>
                    <button id="render">Render</button>
                </div>
                <div class="textarea-editor">
                    <textarea name="editor" id="the-editor">{
  "id": 9421,
  "user": {
    "name": "Lara Quinn",
    "age": 27,
    "location": "Oslo, Norway",
    "hobbies": ["photography", "skiing", "baking"]
  },
  "isVerified": true,
  "accountBalance": 1532.45,
  "lastLogin": "2025-10-09T05:37:12Z",
  "preferences": {
    "theme": "dark",
    "notifications": {
      "email": true,
      "sms": false,
      "push": true
    }
  },
  "projects": [
    {
      "name": "Aurora Trails",
      "status": "active",
      "contributors": 4
    },
    {
      "name": "SkyBake",
      "status": "completed",
      "contributors": 2
    }
  ]
}</textarea>
                </div>
            </div>
            <div class="visualization">
                <div class="zoom-level" id="zoomLevel">100%</div>
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoomOutBtn" title="Zoom Out">−</button>
                    <button class="zoom-btn" id="zoomInBtn" title="Zoom In">+</button>
                    <button class="zoom-btn" id="resetZoomBtn" title="Reset Zoom">⟲</button>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" id="visualizer">
                    <g>
                        <defs>
                            <pattern id="smallGrid" width="12" height="12" patternUnits="userSpaceOnUse">
                                <path d="M 12 0 L 0 0 0 12" fill="none" stroke="#444" stroke-opacity=".8" stroke-width="0.2"/>
                            </pattern>
                            <pattern id="grid" width="120" height="120" patternUnits="userSpaceOnUse">
                                <rect width="120" height="120" fill="url(#smallGrid)"/>
                                <path d="M 120 0 L 0 0 0 120" fill="none" stroke="#444" stroke-width="1"/>
                            </pattern>
                        </defs>
                        <rect id="background" x="-10000px" y="-10000px" width="20000px" height="20000px" fill="url(#grid)"></rect>
                    </g>
                    <g id="cards"></g>
                    <g id="lines"></g>
                </svg>
            </div>
        </div>
    </div>

    <script type="module">
        // JSON Visualizer - Clean Implementation
        class Visualizer {
            constructor(svg, data) {
                this.svg = svg
                this.data = data
                this.cards = svg.querySelector('#cards')
                this.lines = svg.querySelector('#lines')
                
                // State
                this.isPanning = false
                this.startPoint = { x: 0, y: 0 }
                this.offset = { x: 0, y: 0 }
                this.currentZoom = 1
                this.minZoom = 0.1
                this.maxZoom = 3
                
                // Position tracking
                this.currentX = 100
                this.currentY = 100
                this.maxDepth = 0
                
                // ViewBox state
                this.viewBox = { x: -200, y: -100, width: 1400, height: 900 }
                
                this.init()
            }
            
            init() {
                this.setupPanZoom()
                this.render()
                this.updateZoomDisplay()
            }
            
            setupPanZoom() {
                this.svg.setAttribute('viewBox', `${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`)
                
                const getPointFromEvent = (e) => {
                    const point = this.svg.createSVGPoint()
                    if (e.touches) {
                        point.x = e.touches[0].clientX
                        point.y = e.touches[0].clientY
                    } else {
                        point.x = e.clientX
                        point.y = e.clientY
                    }
                    return point.matrixTransform(this.svg.getScreenCTM().inverse())
                }
                
                const onPointerDown = (e) => {
                    this.isPanning = true
                    this.startPoint = getPointFromEvent(e)
                    this.svg.style.cursor = 'grabbing'
                    
                    // Prevent text selection
                    e.preventDefault()
                    document.body.style.userSelect = 'none'
                }
                
                const onPointerMove = (e) => {
                    if (!this.isPanning) return
                    
                    e.preventDefault()
                    const point = getPointFromEvent(e)
                    const dx = point.x - this.startPoint.x
                    const dy = point.y - this.startPoint.y
                    
                    this.viewBox.x -= dx
                    this.viewBox.y -= dy
                    
                    this.svg.setAttribute('viewBox', `${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`)
                }
                
                const onPointerUp = () => {
                    this.isPanning = false
                    this.svg.style.cursor = 'grab'
                    document.body.style.userSelect = ''
                }
                
                const onWheel = (e) => {
                    e.preventDefault()
                    
                    const point = getPointFromEvent(e)
                    const scale = e.deltaY > 0 ? 1.1 : 0.9
                    
                    this.zoomToPoint(point.x, point.y, scale)
                }
                
                this.svg.addEventListener('mousedown', onPointerDown)
                this.svg.addEventListener('mousemove', onPointerMove)
                this.svg.addEventListener('mouseup', onPointerUp)
                this.svg.addEventListener('mouseleave', onPointerUp)
                this.svg.addEventListener('wheel', onWheel, { passive: false })
                
                // Touch events
                this.svg.addEventListener('touchstart', onPointerDown, { passive: false })
                this.svg.addEventListener('touchmove', onPointerMove, { passive: false })
                this.svg.addEventListener('touchend', onPointerUp)
            }
            
            render() {
                this.cards.innerHTML = ''
                this.lines.innerHTML = ''
                this.currentX = 100
                this.currentY = 100
                this.maxDepth = 0
                
                this.createNode(this.data, 'root', this.currentX, this.currentY, 0)
            }
            
            createNode(data, key, x, y, depth) {
                const isObject = typeof data === 'object' && data !== null && !Array.isArray(data)
                const isArray = Array.isArray(data)
                const isPrimitive = !isObject && !isArray
                
                // Create card
                const card = this.createCard(data, key, x, y, isPrimitive)
                this.cards.appendChild(card)
                
                if (isObject || isArray) {
                    const entries = isArray ? data.map((v, i) => [i, v]) : Object.entries(data)
                    const childX = x + 400
                    let childY = y
                    
                    entries.forEach(([childKey, childValue], index) => {
                        // Create line
                        const line = this.createLine(x, y, childX, childY)
                        this.lines.appendChild(line)
                        
                        // Create child node
                        this.createNode(childValue, isArray ? `[${childKey}]` : childKey, childX, childY, depth + 1)
                        
                        childY += 140
                    })
                }
                
                return card
            }
            
            createCard(data, key, x, y, isPrimitive) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g')
                g.setAttribute('id', 'card')
                
                // Calculate dynamic height based on content
                let cardHeight = 40
                let contentLines = []
                
                if (isPrimitive) {
                    contentLines = [{ key: key, value: this.formatValue(data) }]
                    cardHeight = 50
                } else if (Array.isArray(data)) {
                    contentLines = [{ key: key, value: `[${data.length} items]`, isExtension: true }]
                    cardHeight = 50
                } else {
                    const entries = Object.entries(data)
                    if (entries.length <= 3) {
                        // Show all properties inline
                        entries.forEach(([k, v]) => {
                            contentLines.push({ key: k, value: this.formatValue(v) })
                        })
                        cardHeight = 30 + (entries.length * 22)
                    } else {
                        // Show summary
                        contentLines = [{ key: key, value: `{${entries.length} properties}`, isExtension: true }]
                        cardHeight = 50
                    }
                }
                
                const cardWidth = 280
                
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect')
                rect.setAttribute('x', x)
                rect.setAttribute('y', y)
                rect.setAttribute('width', cardWidth)
                rect.setAttribute('height', cardHeight)
                rect.setAttribute('fill', 'rgba(60, 60, 65, 0.95)')
                rect.setAttribute('rx', '6')
                rect.setAttribute('stroke', 'rgba(100, 100, 110, 0.3)')
                rect.setAttribute('stroke-width', '1')
                
                const foreignObject = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject')
                foreignObject.setAttribute('x', x + 8)
                foreignObject.setAttribute('y', y + 8)
                foreignObject.setAttribute('width', cardWidth - 16)
                foreignObject.setAttribute('height', cardHeight - 16)
                foreignObject.setAttribute('class', 'card-content')
                
                const content = document.createElement('div')
                content.className = 'object-text-wrapper'
                
                let html = ''
                contentLines.forEach(line => {
                    if (line.isExtension) {
                        html += `<div><span class="object-key">${line.key}</span></div>`
                    } else {
                        html += `<div><span class="object-key">${line.key}</span>: <span class="object-value">${line.value}</span></div>`
                    }
                })
                
                content.innerHTML = html
                
                foreignObject.appendChild(content)
                g.appendChild(rect)
                g.appendChild(foreignObject)
                
                return g
            }
            
            createLine(x1, y1, x2, y2) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path')
                
                const cardWidth = 280
                const startX = x1 + cardWidth
                const startY = y1 + 25
                const endX = x2
                const endY = y2 + 25
                
                const midX = (startX + endX) / 2
                
                const d = `M${startX},${startY} Q${midX},${startY} ${midX},${endY} Q${midX},${endY} ${endX},${endY}`
                
                path.setAttribute('d', d)
                path.setAttribute('stroke', 'rgba(200, 200, 200, 0.4)')
                path.setAttribute('stroke-width', '2')
                path.setAttribute('fill', 'none')
                
                return path
            }
            
            formatValue(value) {
                if (value === null) return 'null'
                if (typeof value === 'string') return `"${value}"`
                if (typeof value === 'number') return value.toString()
                if (typeof value === 'boolean') return value.toString()
                return String(value)
            }
            
            zoomToPoint(x, y, scale) {
                const newWidth = this.viewBox.width * scale
                const newHeight = this.viewBox.height * scale
                
                // Calculate new zoom level
                const baseWidth = 1400
                const newZoom = baseWidth / newWidth
                
                // Clamp zoom level
                if (newZoom < this.minZoom || newZoom > this.maxZoom) {
                    return
                }
                
                this.currentZoom = newZoom
                
                // Zoom towards point
                this.viewBox.x = x - (x - this.viewBox.x) * scale
                this.viewBox.y = y - (y - this.viewBox.y) * scale
                this.viewBox.width = newWidth
                this.viewBox.height = newHeight
                
                this.svg.setAttribute('viewBox', `${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`)
                this.updateZoomDisplay()
            }
            
            zoomIn() {
                const centerX = this.viewBox.x + this.viewBox.width / 2
                const centerY = this.viewBox.y + this.viewBox.height / 2
                this.zoomToPoint(centerX, centerY, 0.8)
            }
            
            zoomOut() {
                const centerX = this.viewBox.x + this.viewBox.width / 2
                const centerY = this.viewBox.y + this.viewBox.height / 2
                this.zoomToPoint(centerX, centerY, 1.25)
            }
            
            resetZoom() {
                this.viewBox = { x: -200, y: -100, width: 1400, height: 900 }
                this.currentZoom = 1
                this.svg.setAttribute('viewBox', `${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`)
                this.updateZoomDisplay()
            }
            
            updateZoomDisplay() {
                const zoomLevel = document.getElementById('zoomLevel')
                if (zoomLevel) {
                    zoomLevel.textContent = `${Math.round(this.currentZoom * 100)}%`
                }
                
                // Update button states
                const zoomInBtn = document.getElementById('zoomInBtn')
                const zoomOutBtn = document.getElementById('zoomOutBtn')
                
                if (zoomInBtn) {
                    zoomInBtn.disabled = this.currentZoom >= this.maxZoom
                }
                if (zoomOutBtn) {
                    zoomOutBtn.disabled = this.currentZoom <= this.minZoom
                }
            }
            
            updateData(newData) {
                this.data = newData
                this.render()
            }
        }

        // Initialize
        let data = {}

        const getData = () => {
            const editor = document.querySelector('#the-editor')
            try {
                data = JSON.parse(editor.value)
                return data
            } catch (error) {
                alert('Invalid JSON: ' + error.message)
                return null
            }
        }

        getData()

        const svg = document.querySelector('#visualizer')
        const vis = new Visualizer(svg, data)

        const renderButton = document.querySelector('#render')
        renderButton?.addEventListener('click', () => {
            const newData = getData()
            if (newData !== null) {
                vis.updateData(newData)
            }
        })
        
        // Zoom button controls
        const zoomInBtn = document.getElementById('zoomInBtn')
        const zoomOutBtn = document.getElementById('zoomOutBtn')
        const resetZoomBtn = document.getElementById('resetZoomBtn')
        
        zoomInBtn?.addEventListener('click', () => {
            vis.zoomIn()
        })
        
        zoomOutBtn?.addEventListener('click', () => {
            vis.zoomOut()
        })
        
        resetZoomBtn?.addEventListener('click', () => {
            vis.resetZoom()
        })
    </script>
</body>
</html>
